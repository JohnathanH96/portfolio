@model BatemanCafeteria.ViewModels.ShoppingCartViewModel
@{
    ViewBag.Title = "Shopping Cart";
}
<script src="~/Scripts/jquery-3.3.1.min.js"
        type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        // Document.ready -> link up remove event handler
        $(".RemoveLink").click(function () {
            // Get the id from the link
            var recordToDelete = $(this).attr("data-id");
            if (recordToDelete != '') {
                // Perform the ajax post
                $.post("/ShoppingCart/RemoveFromCart", { "id": recordToDelete }, function (data) {
                    // Successful requests get here
                    // Update the page elements
                    if (data.ItemCount == 0) {
                        $('#row-' + data.DeleteID).fadeOut('slow');
                    } else {
                        $('#item-count-' + data.DeleteID).text(data.ItemCount);
                    }
                    if ($('.RemoveLink').length == 1 && $('.RemoveLink').is(':visible')) {
                        $('#checkout').hide();
                    }
                    $('#cart-total').text('$' + data.CartTotal);
                    $('#catering-total').text('-$' + data.CartTotal)
                    $('#update-message').text(data.Message);
                    $('#cart-status').text('Cart (' + data.CartCount + ')');
                });
            }
        });
    });
</script>
<h3>
    <em>Review</em> your cart:
</h3>
<div id="update-message">
</div>
@if (Model.CartItems.Count == 0)
{
    <h2>Your cart is empty!</h2>
}
else
{
<table>
    <tr>
        <th class="col-md-4">
            Item Name
        </th>
        <th class="col-md-4">
            Price (each)
        </th>
        <th class="col-md-4">
            Quantity
        </th>
        <th></th>
    </tr>
    @foreach (var item in Model.CartItems)
    {
        <tr id="row-@item.RecordID">
            <td class="col-md-4">
                @item.MenuItem.Title
            </td>
            <td class="col-md-4">
                $@item.MenuItem.Price
            </td>
            <td id="item-count-@item.RecordID" class="col-md-4">
                @item.Quantity
            </td>
            <td>
                <a class="RemoveLink"
                   data-id="@item.RecordID">
                    <div class="x">
                        <span>X</span>
                    </div>
                </a>
            </td>
        </tr>
    }
    @if (User.IsInRole("Caf_Secretary"))
    {
        <tr>
            <td style="color: red; font-style: italic">Catering</td>
            <td></td>
            <td></td>
            <td id="catering-total" style="color: red; font-style: italic">
                -$@Model.CartTotal
            </td>
        </tr>
        <tr>
            <td>
                Total
            </td>
            <td></td>
            <td></td>
            <td id="cart-total">
                $0.00
            </td>
        </tr>
    }
    else
    {
        <tr>
            <td>
                Total
            </td>
            <td></td>
            <td></td>
            <td id="cart-total">
                $@Model.CartTotal
            </td>
        </tr>
    }
</table>
}
@if (Model.CartItems.Count != 0)
{
<div class="flex padding-top-medium" style="justify-content: space-around">
    <div class="btn btn-primary" id="checkout">
        @if (User.IsInRole("Caf_Secretary"))
        {
            @Html.ActionLink("Proceed to Checkout", "CateringVerification", "Checkout", "", new { @class = "modal-link" })
        }
        else
        {
            @Html.ActionLink("Proceed to Checkout", "Checkout", "Checkout")
        }
    </div>
    <div class="btn btn-danger">
            @Html.ActionLink("Empty Cart", "EmptyCart", "ShoppingCart")
    </div>
</div>
}